<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.bizcode.core.dao.DefaultAuthenticationProviderDao">

	<resultMap type="MMap"   					id="user">
		<id property="id"	    				column="id"/>
		<result property="username" 			column="user_name"/>
		<result property="password" 			column="password"/>
		<result property="accountExpired" 		column="account_expired"/>
		<result property="accountLocked" 		column="account_locked"/>
		<result property="credentialsExpired" 	column="credentials_expired"/>
		<result property="enabled" 				column="enabled"/>
		<association property="authorities" 	resultMap="authority" javaType="list"/>
	</resultMap>

	<resultMap type="MMap" 			id="authority">
		<id property="id" 			column="authority_id"/>
		<result property="name"  	column="authority_name"/>
	</resultMap>

	<select id="getUserByName" resultMap="user">
	   <![CDATA[
			select
				u.id
				, u.user_name
				, u."password"
				, u.account_expired
				, u.account_locked
				, u.credentials_expired
				, u.enabled
				, a."name"		as "authority_name"
				, a.id 			as "authority_id"
			from user_ u
			inner join users_authorities ua on ua.user_id = u.id
			inner join authority a on a.id = ua.authority_id
			where u.user_name = #{username}
	   ]]>
	</select>

</mapper>